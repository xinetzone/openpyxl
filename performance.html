
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>性能 &#8212; openpyxl 3.0.9 文档</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/nature.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/translations.js"></script>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="优化模式" href="optimized.html" />
    <link rel="prev" title="简单用法" href="usage.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python 模块索引"
             >模块</a> |</li>
        <li class="right" >
          <a href="optimized.html" title="优化模式"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="usage.html" title="简单用法"
             accesskey="P">上一页</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">openpyxl 3.0.9 文档</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">性能</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="performance">
<h1>性能<a class="headerlink" href="#performance" title="永久链接至标题">¶</a></h1>
<p>openpyxl 尝试来平衡功能与性能。如果有疑问，我们把重点放在功能而非性能上：一旦建立了 API ，性能调整将变得更简单。与其他库和应用程序相比，内存使用率很高，约为原始文件大小的 50 倍，例如 50 MB 的 Excel 文件为内存使用约为 2.5 GB。</p>
<section id="benchmarks">
<h2>基准测试<a class="headerlink" href="#benchmarks" title="永久链接至标题">¶</a></h2>
<p>所有基准都是综合性的，并且高度依赖于硬件，但是它们仍然可以提供说明（indication）。</p>
<section id="write-performance">
<h3>写入性能<a class="headerlink" href="#write-performance" title="永久链接至标题">¶</a></h3>
<p><a class="reference external" href="https://foss.heptapod.net/openpyxl/openpyxl/-/snippets/66">benchmark code</a> 可以调整使用更多的工作表以及数据中字符串的比例。由于不同版本的 Python 也会对性能有着显著影响，所以使用了  <a class="reference external" href="https://foss.heptapod.net/openpyxl/openpyxl/-/snippets/67">driver script</a> 对 tox 环境下不同的版本 Python 进行测试。</p>
<p>性能与出色的替代库 xlsxwriter 进行了比较</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Versions</span><span class="p">:</span>
<span class="n">python</span><span class="p">:</span> <span class="mf">3.6.9</span>
<span class="n">openpyxl</span><span class="p">:</span> <span class="mf">3.0.1</span>
<span class="n">xlsxwriter</span><span class="p">:</span> <span class="mf">1.2.5</span>

<span class="n">Dimensions</span><span class="p">:</span>
    <span class="n">Rows</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="n">Cols</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">Sheets</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">Proportion</span> <span class="n">text</span> <span class="o">=</span> <span class="mf">0.10</span>

<span class="n">Times</span><span class="p">:</span>
    <span class="n">xlsxwriter</span>            <span class="p">:</span>   <span class="mf">0.59</span>
    <span class="n">xlsxwriter</span> <span class="p">(</span><span class="n">optimised</span><span class="p">):</span>   <span class="mf">0.54</span>
    <span class="n">openpyxl</span>              <span class="p">:</span>   <span class="mf">0.73</span>
    <span class="n">openpyxl</span> <span class="p">(</span><span class="n">optimised</span><span class="p">)</span>  <span class="p">:</span>   <span class="mf">0.61</span>


<span class="n">Versions</span><span class="p">:</span>
<span class="n">python</span><span class="p">:</span> <span class="mf">3.7.5</span>
<span class="n">openpyxl</span><span class="p">:</span> <span class="mf">3.0.1</span>
<span class="n">xlsxwriter</span><span class="p">:</span> <span class="mf">1.2.5</span>

<span class="n">Dimensions</span><span class="p">:</span>
    <span class="n">Rows</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="n">Cols</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">Sheets</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">Proportion</span> <span class="n">text</span> <span class="o">=</span> <span class="mf">0.10</span>

<span class="n">Times</span><span class="p">:</span>
    <span class="n">xlsxwriter</span>            <span class="p">:</span>   <span class="mf">0.65</span>
    <span class="n">xlsxwriter</span> <span class="p">(</span><span class="n">optimised</span><span class="p">):</span>   <span class="mf">0.53</span>
    <span class="n">openpyxl</span>              <span class="p">:</span>   <span class="mf">0.70</span>
    <span class="n">openpyxl</span> <span class="p">(</span><span class="n">optimised</span><span class="p">)</span>  <span class="p">:</span>   <span class="mf">0.63</span>


<span class="n">Versions</span><span class="p">:</span>
<span class="n">python</span><span class="p">:</span> <span class="mf">3.8.0</span>
<span class="n">openpyxl</span><span class="p">:</span> <span class="mf">3.0.1</span>
<span class="n">xlsxwriter</span><span class="p">:</span> <span class="mf">1.2.5</span>

<span class="n">Dimensions</span><span class="p">:</span>
    <span class="n">Rows</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="n">Cols</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">Sheets</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">Proportion</span> <span class="n">text</span> <span class="o">=</span> <span class="mf">0.10</span>

<span class="n">Times</span><span class="p">:</span>
    <span class="n">xlsxwriter</span>            <span class="p">:</span>   <span class="mf">0.54</span>
    <span class="n">xlsxwriter</span> <span class="p">(</span><span class="n">optimised</span><span class="p">):</span>   <span class="mf">0.50</span>
    <span class="n">openpyxl</span>              <span class="p">:</span>   <span class="mf">1.10</span>
    <span class="n">openpyxl</span> <span class="p">(</span><span class="n">optimised</span><span class="p">)</span>  <span class="p">:</span>   <span class="mf">0.57</span>
</pre></div>
</div>
</section>
<section id="read-performance">
<h3>读取性能<a class="headerlink" href="#read-performance" title="永久链接至标题">¶</a></h3>
<p>读取性能测试使用了 <a class="reference external" href="https://bitbucket.org/openpyxl/openpyxl/issues/494/">bug report</a> 提供的文件，和早期的 xlrd 库进行比较。xlrd 主要用于 .XLS 文件较旧的 BIFF 文件格式，它对 XLSX 文件支持有限。</p>
<p><a class="reference external" href="https://foss.heptapod.net/openpyxl/openpyxl/-/snippets/68">benchmark</a> 代码显示了处理文件时正确选项的重要性。在这种情况下，禁用外部链接将让 openpyxl 停止打开链接工作表的缓存副本。</p>
<p>两个库的主要区别是 openpyxl 的只读模式可以快速打开工作簿，使其适用于多进程，这也大大减少了内存的使用。xlrd 也不会自动将日期和时间转换为 Python 的 datetime，尽管它会相应地注释单元格（annotate cells），但是在客户端代码中这样做会大大降低性能。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Versions</span><span class="p">:</span>
<span class="n">python</span><span class="p">:</span> <span class="mf">3.6.9</span>
<span class="n">xlread</span><span class="p">:</span> <span class="mf">1.2.0</span>
<span class="n">openpyxl</span><span class="p">:</span> <span class="mf">3.0.1</span>

<span class="n">openpyxl</span><span class="p">,</span> <span class="n">read</span><span class="o">-</span><span class="n">only</span>
    <span class="n">Workbook</span> <span class="n">loaded</span> <span class="mf">1.14</span><span class="n">s</span>
    <span class="n">OptimizationData</span> <span class="mf">23.17</span><span class="n">s</span>
    <span class="n">Output</span> <span class="n">Model</span> <span class="mf">0.00</span><span class="n">s</span>
    <span class="o">&gt;&gt;</span><span class="n">DATA</span><span class="o">&gt;&gt;</span> <span class="mf">0.00</span><span class="n">s</span>
    <span class="n">Store</span> <span class="n">days</span> <span class="mi">0</span><span class="o">%</span> <span class="mf">23.92</span><span class="n">s</span>
    <span class="n">Store</span> <span class="n">days</span> <span class="mi">100</span><span class="o">%</span> <span class="mf">17.35</span><span class="n">s</span>
    <span class="n">Total</span> <span class="n">time</span> <span class="mf">65.59</span><span class="n">s</span>
    <span class="mi">0</span> <span class="n">cells</span> <span class="ow">in</span> <span class="n">total</span>

<span class="n">Versions</span><span class="p">:</span>
<span class="n">python</span><span class="p">:</span> <span class="mf">3.7.5</span>
<span class="n">xlread</span><span class="p">:</span> <span class="mf">1.2.0</span>
<span class="n">openpyxl</span><span class="p">:</span> <span class="mf">3.0.1</span>

<span class="n">openpyxl</span><span class="p">,</span> <span class="n">read</span><span class="o">-</span><span class="n">only</span>
    <span class="n">Workbook</span> <span class="n">loaded</span> <span class="mf">0.98</span><span class="n">s</span>
    <span class="n">OptimizationData</span> <span class="mf">21.35</span><span class="n">s</span>
    <span class="n">Output</span> <span class="n">Model</span> <span class="mf">0.00</span><span class="n">s</span>
    <span class="o">&gt;&gt;</span><span class="n">DATA</span><span class="o">&gt;&gt;</span> <span class="mf">0.00</span><span class="n">s</span>
    <span class="n">Store</span> <span class="n">days</span> <span class="mi">0</span><span class="o">%</span> <span class="mf">20.70</span><span class="n">s</span>
    <span class="n">Store</span> <span class="n">days</span> <span class="mi">100</span><span class="o">%</span> <span class="mf">16.16</span><span class="n">s</span>
    <span class="n">Total</span> <span class="n">time</span> <span class="mf">59.19</span><span class="n">s</span>
    <span class="mi">0</span> <span class="n">cells</span> <span class="ow">in</span> <span class="n">total</span>

<span class="n">Versions</span><span class="p">:</span>
<span class="n">python</span><span class="p">:</span> <span class="mf">3.8.0</span>
<span class="n">xlread</span><span class="p">:</span> <span class="mf">1.2.0</span>
<span class="n">openpyxl</span><span class="p">:</span> <span class="mf">3.0.1</span>

<span class="n">openpyxl</span><span class="p">,</span> <span class="n">read</span><span class="o">-</span><span class="n">only</span>
    <span class="n">Workbook</span> <span class="n">loaded</span> <span class="mf">0.90</span><span class="n">s</span>
    <span class="n">OptimizationData</span> <span class="mf">19.58</span><span class="n">s</span>
    <span class="n">Output</span> <span class="n">Model</span> <span class="mf">0.00</span><span class="n">s</span>
    <span class="o">&gt;&gt;</span><span class="n">DATA</span><span class="o">&gt;&gt;</span> <span class="mf">0.00</span><span class="n">s</span>
    <span class="n">Store</span> <span class="n">days</span> <span class="mi">0</span><span class="o">%</span> <span class="mf">19.35</span><span class="n">s</span>
    <span class="n">Store</span> <span class="n">days</span> <span class="mi">100</span><span class="o">%</span> <span class="mf">15.02</span><span class="n">s</span>
    <span class="n">Total</span> <span class="n">time</span> <span class="mf">54.85</span><span class="n">s</span>
    <span class="mi">0</span> <span class="n">cells</span> <span class="ow">in</span> <span class="n">total</span>
</pre></div>
</div>
</section>
<section id="parallelisation">
<h3>并行<a class="headerlink" href="#parallelisation" title="永久链接至标题">¶</a></h3>
<p>读取工作表会占用大量 CPU 从而限制了从并行中获取好处。但是，如果你主要对 dump 工作表内容感兴趣，你可以使用 openpyxl 的只读模式打开复数工作表来利用多核 CPU。</p>
<p><a class="reference external" href="https://foss.heptapod.net/openpyxl/openpyxl/-/snippets/69">示例代码</a> 使用与读取性能相同的源文件显示，由于创建额外的 Python 进程，性能可以合理地扩展，而开销很小。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Parallised</span> <span class="n">Read</span>
    <span class="n">Workbook</span> <span class="n">loaded</span> <span class="mf">1.12</span><span class="n">s</span>
    <span class="o">&gt;&gt;</span><span class="n">DATA</span><span class="o">&gt;&gt;</span> <span class="mf">2.27</span><span class="n">s</span>
    <span class="n">Output</span> <span class="n">Model</span> <span class="mf">2.30</span><span class="n">s</span>
    <span class="n">Store</span> <span class="n">days</span> <span class="mi">100</span><span class="o">%</span> <span class="mf">37.18</span><span class="n">s</span>
    <span class="n">OptimizationData</span> <span class="mf">44.09</span><span class="n">s</span>
    <span class="n">Store</span> <span class="n">days</span> <span class="mi">0</span><span class="o">%</span> <span class="mf">45.60</span><span class="n">s</span>
    <span class="n">Total</span> <span class="n">time</span> <span class="mf">46.76</span><span class="n">s</span>
</pre></div>
</div>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo.png" alt="Logo"/>
            </a></p>
  <div>
    <h3><a href="index.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#">性能</a><ul>
<li><a class="reference internal" href="#benchmarks">基准测试</a><ul>
<li><a class="reference internal" href="#write-performance">写入性能</a></li>
<li><a class="reference internal" href="#read-performance">读取性能</a></li>
<li><a class="reference internal" href="#parallelisation">并行</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="usage.html"
                          title="上一章">简单用法</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="optimized.html"
                          title="下一章">优化模式</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/performance.rst.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python 模块索引"
             >模块</a> |</li>
        <li class="right" >
          <a href="optimized.html" title="优化模式"
             >下一页</a> |</li>
        <li class="right" >
          <a href="usage.html" title="简单用法"
             >上一页</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">openpyxl 3.0.9 文档</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">性能</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; 版权所有 2010 - 2022, See AUTHORS.
      由 <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.5.0创建。
    </div>
  </body>
</html>