
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>优化模式 &#8212; openpyxl 3.0.9 文档</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/nature.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/translations.js"></script>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="插入删除行或列, 移动范围单元格" href="editing_worksheets.html" />
    <link rel="prev" title="性能" href="performance.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python 模块索引"
             >模块</a> |</li>
        <li class="right" >
          <a href="editing_worksheets.html" title="插入删除行或列, 移动范围单元格"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="performance.html" title="性能"
             accesskey="P">上一页</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">openpyxl 3.0.9 文档</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">优化模式</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="optimised-modes">
<h1>优化模式<a class="headerlink" href="#optimised-modes" title="永久链接至标题">¶</a></h1>
<section id="read-only-mode">
<h2>只读模式<a class="headerlink" href="#read-only-mode" title="永久链接至标题">¶</a></h2>
<p>有时，你可能需要打开或写入极端大的 XLSX 文件，但通用的 openpyxl 程序无法处理这么大的负载。幸运的是，有两种模式可以使你在（几乎）恒定的内存消耗下读写无限量的数据。</p>
<p>介绍 <code class="xref py py-class docutils literal notranslate"><span class="pre">openpyxl.worksheet._read_only.ReadOnlyWorksheet</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">openpyxl</span> <span class="kn">import</span> <span class="n">load_workbook</span>
<span class="n">wb</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;large_file.xlsx&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">wb</span><span class="p">[</span><span class="s1">&#39;big_data&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">ws</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

<span class="c1"># Close the workbook after reading</span>
<span class="n">wb</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<ul class="simple">
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">openpyxl.worksheet._read_only.ReadOnlyWorksheet</span></code> 是只读的</p></li>
<li><p>与普通工作簿不同，只读工作簿将使用惰性加载。工作簿必须用 <code class="xref py py-func docutils literal notranslate"><span class="pre">close()</span></code> 方法显式关闭。</p></li>
</ul>
</div>
<p>单元格的返回值不是 <a class="reference internal" href="api/openpyxl.cell.cell.html#openpyxl.cell.cell.Cell" title="openpyxl.cell.cell.Cell"><code class="xref py py-class docutils literal notranslate"><span class="pre">openpyxl.cell.cell.Cell</span></code></a> 而是 <code class="xref py py-class docutils literal notranslate"><span class="pre">openpyxl.cell._read_only.ReadOnlyCell</span></code>。</p>
<section id="worksheet-dimensions">
<h3>工作表维度（dimensions）<a class="headerlink" href="#worksheet-dimensions" title="永久链接至标题">¶</a></h3>
<p>只读模式依赖创建文件的应用以及库提供工作表的正确信息，尤其是文件的已使用部分，称之为维度（dimensions）。一些应用会进行设置错误。可以使用 <code class="docutils literal notranslate"><span class="pre">ws.calculate_dimension()</span></code> 函数来检查工作表的维度。如果返回范围和你知道的不一样，比如说 <code class="docutils literal notranslate"><span class="pre">A1:A1</span></code> ，你可以简单重置 <code class="docutils literal notranslate"><span class="pre">max_row</span></code> 和 <code class="docutils literal notranslate"><span class="pre">max_column</span></code> 属性，即可使用该文件:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span><span class="o">.</span><span class="n">reset_dimensions</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="write-only-mode">
<h2>只写模式<a class="headerlink" href="#write-only-mode" title="永久链接至标题">¶</a></h2>
<p>常规的 <a class="reference internal" href="api/openpyxl.worksheet.worksheet.html#openpyxl.worksheet.worksheet.Worksheet" title="openpyxl.worksheet.worksheet.Worksheet"><code class="xref py py-class docutils literal notranslate"><span class="pre">openpyxl.worksheet.worksheet.Worksheet</span></code></a> 被替代成更快的 <code class="xref py py-class docutils literal notranslate"><span class="pre">openpyxl.worksheet._write_only.WriteOnlyWorksheet</span></code>。当你想导出大量数据的时候请确保安装了 <code class="docutils literal notranslate"><span class="pre">lxml</span></code> 库。</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">openpyxl</span> <span class="kn">import</span> <span class="n">Workbook</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wb</span> <span class="o">=</span> <span class="n">Workbook</span><span class="p">(</span><span class="n">write_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ws</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">create_sheet</span><span class="p">()</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># now we&#39;ll fill it with 100 rows x 200 columns</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">irow</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">ws</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">200</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># save the file</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wb</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;new_big_file.xlsx&#39;</span><span class="p">)</span> 
</pre></div>
</div>
<p>如果你想要带有样式或者注释的单元格可以使用 <code class="xref py py-func docutils literal notranslate"><span class="pre">openpyxl.cell.WriteOnlyCell()</span></code></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">openpyxl</span> <span class="kn">import</span> <span class="n">Workbook</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wb</span> <span class="o">=</span> <span class="n">Workbook</span><span class="p">(</span><span class="n">write_only</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ws</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">create_sheet</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">openpyxl.cell</span> <span class="kn">import</span> <span class="n">WriteOnlyCell</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">openpyxl.comments</span> <span class="kn">import</span> <span class="n">Comment</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">openpyxl.styles</span> <span class="kn">import</span> <span class="n">Font</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cell</span> <span class="o">=</span> <span class="n">WriteOnlyCell</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;hello world&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cell</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">Font</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Courier&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">36</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cell</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">Comment</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;A comment&quot;</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="s2">&quot;Author&#39;s Name&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ws</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">cell</span><span class="p">,</span> <span class="mf">3.14</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wb</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;write_only_file.xlsx&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>以上会创建只有一张工作表的只写工作簿，一行写入（append）三个单元格：一个带有自定义字体和注释的文字单元格，一个浮点数单元格和一个空单元格（一定会被丢弃）。</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<ul class="simple">
<li><p>和普通工作簿不同的是，新创建的只写工作簿没有任何工作表；工作表只能由 <code class="xref py py-func docutils literal notranslate"><span class="pre">create_sheet()</span></code> 方法进行创建。</p></li>
<li><p>在只读工作簿中，只能由 <code class="xref py py-func docutils literal notranslate"><span class="pre">append()</span></code> 来添加行。无法使用 <code class="xref py py-func docutils literal notranslate"><span class="pre">cell()</span></code> 或 <code class="xref py py-func docutils literal notranslate"><span class="pre">iter_rows()</span></code> 对任意位置的单元进行读取或写入。</p></li>
<li><p>可以导出不限量的数据（即使超过 Excel 的处理上限），同时内存使用量小于 10Mb。</p></li>
<li><p>只写工作簿只能保存一次。之后如果任何尝试保存和添加数据（<code class="docutils literal notranslate"><span class="pre">append()</span></code>）的操作都会引发 <a class="reference internal" href="api/openpyxl.utils.exceptions.html#openpyxl.utils.exceptions.WorkbookAlreadySaved" title="openpyxl.utils.exceptions.WorkbookAlreadySaved"><code class="xref py py-class docutils literal notranslate"><span class="pre">openpyxl.utils.exceptions.WorkbookAlreadySaved</span></code></a> 异常。</p></li>
<li><p>在实际单元格数据之前出现在文件中的所有内容都必须在添加单元格之前创建，因为它必须在添加单元格之前写入文件。例如，<code class="docutils literal notranslate"><span class="pre">freeze_panes</span></code> 应该在添加单元格之前设置。</p></li>
</ul>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo.png" alt="Logo"/>
            </a></p>
  <div>
    <h3><a href="index.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#">优化模式</a><ul>
<li><a class="reference internal" href="#read-only-mode">只读模式</a><ul>
<li><a class="reference internal" href="#worksheet-dimensions">工作表维度（dimensions）</a></li>
</ul>
</li>
<li><a class="reference internal" href="#write-only-mode">只写模式</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="performance.html"
                          title="上一章">性能</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="editing_worksheets.html"
                          title="下一章">插入删除行或列, 移动范围单元格</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/optimized.rst.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python 模块索引"
             >模块</a> |</li>
        <li class="right" >
          <a href="editing_worksheets.html" title="插入删除行或列, 移动范围单元格"
             >下一页</a> |</li>
        <li class="right" >
          <a href="performance.html" title="性能"
             >上一页</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">openpyxl 3.0.9 文档</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">优化模式</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; 版权所有 2010 - 2022, See AUTHORS.
      由 <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.5.0创建。
    </div>
  </body>
</html>