
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Dates and Times &#8212; openpyxl 3.0.9 文档</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/nature.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/translations.js"></script>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="保护" href="protection.html" />
    <link rel="prev" title="Parsing Formulas" href="formula.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python 模块索引"
             >模块</a> |</li>
        <li class="right" >
          <a href="protection.html" title="保护"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="formula.html" title="Parsing Formulas"
             accesskey="P">上一页</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">openpyxl 3.0.9 文档</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Dates and Times</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="dates-and-times">
<h1>Dates and Times<a class="headerlink" href="#dates-and-times" title="永久链接至标题">¶</a></h1>
<p>Dates and times can be stored in two distinct ways in XLSX files: as an
ISO 8601 formatted string or as a single number. <cite>openpyxl</cite> supports
both representations and translates between them and Python’s datetime
module representations when reading from and writing to files. In either
representation, the maximum date and time precision in XLSX files is
millisecond precision.</p>
<p>XLSX files are not suitable for storing historic dates (before 1900),
due to bugs in Excel that cannot be fixed without causing backward
compatibility problems. To discourage users from trying anyway, Excel
deliberately refuses to recognize and display such dates. Consequently,
it is not advised to use <cite>openpyxl</cite> for such purposes either, especially
when exchanging files with others.</p>
<section id="timezones">
<h2>Timezones<a class="headerlink" href="#timezones" title="永久链接至标题">¶</a></h2>
<p>The date and time representations in Excel do not support timezones,
therefore <cite>openpyxl</cite> can only deal with naive datetime/time objects.
Any timezone information attached to Python datetimes must be stripped
off by the user before datetimes can be stored in XLSX files.</p>
</section>
<section id="using-the-iso-8601-format">
<h2>Using the ISO 8601 format<a class="headerlink" href="#using-the-iso-8601-format" title="永久链接至标题">¶</a></h2>
<p>To make <cite>openpyxl</cite> store dates and times in the ISO 8601 format on
writing your file, set the workbook’s <code class="docutils literal notranslate"><span class="pre">iso_dates</span></code> flag to <code class="docutils literal notranslate"><span class="pre">True</span></code>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">openpyxl</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wb</span> <span class="o">=</span> <span class="n">openpyxl</span><span class="o">.</span><span class="n">Workbook</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wb</span><span class="o">.</span><span class="n">iso_dates</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>The benefit of using this format is that the meaning of the stored
information is not subject to interpretation, as it is with the single
number format <a class="footnote-reference brackets" href="#f1" id="id1">1</a>.</p>
<p>The Office Open XML standard does not specify a supported subset of the
ISO 8601 duration format for representing time interval durations.
<cite>openpyxl</cite> therefore always uses the single number format for timedelta
values when writing them to file.</p>
</section>
<section id="the-1900-and-1904-date-systems">
<h2>The 1900 and 1904 date systems<a class="headerlink" href="#the-1900-and-1904-date-systems" title="永久链接至标题">¶</a></h2>
<p>The ‘date system’ of an XLSX file determines how dates and times in the
single number representation are interpreted. XLSX files always use one
of two possible date systems:</p>
<blockquote>
<div><ul class="simple">
<li><p>In the 1900 date system (the default), the reference date (with number 1) is 1900-01-01.</p></li>
<li><p>In the 1904 date system, the reference date (with number 0) is 1904-01-01.</p></li>
</ul>
</div></blockquote>
<p>Complications arise not only from the different start numbers of the
reference dates, but also from the fact that the 1900 date system has a
built-in (but wrong) assumption that the year 1900 had been a leap year.
Excel deliberately refuses to recognize and display dates before the
reference date correctly, in order to discourage people from storing
historical data.</p>
<dl class="simple">
<dt>More information on this issue is available from Microsoft:</dt><dd><ul class="simple">
<li><p><a class="reference external" href="https://docs.microsoft.com/en-us/office/troubleshoot/excel/1900-and-1904-date-system">https://docs.microsoft.com/en-us/office/troubleshoot/excel/1900-and-1904-date-system</a></p></li>
<li><p><a class="reference external" href="https://docs.microsoft.com/en-us/office/troubleshoot/excel/wrongly-assumes-1900-is-leap-year">https://docs.microsoft.com/en-us/office/troubleshoot/excel/wrongly-assumes-1900-is-leap-year</a></p></li>
</ul>
</dd>
</dl>
<p>In workbooks using the 1900 date system, <cite>openpyxl</cite> behaves the same as
Excel when translating between the worksheets’ date/time numbers and
Python datetimes in January and February 1900. The only exception is 29
February 1900, which cannot be represented as a Python datetime object
since it is not a valid date.</p>
<p>You can get the date system of a workbook like this:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">openpyxl</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wb</span> <span class="o">=</span> <span class="n">openpyxl</span><span class="o">.</span><span class="n">Workbook</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">wb</span><span class="o">.</span><span class="n">epoch</span> <span class="o">==</span> <span class="n">openpyxl</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">CALENDAR_WINDOWS_1900</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This workbook is using the 1900 date system.&quot;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">This workbook is using the 1900 date system.</span>
</pre></div>
</div>
<p>and set it like this:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">wb</span><span class="o">.</span><span class="n">epoch</span> <span class="o">=</span> <span class="n">openpyxl</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">CALENDAR_MAC_1904</span>
</pre></div>
</div>
</section>
<section id="handling-timedelta-values">
<h2>Handling timedelta values<a class="headerlink" href="#handling-timedelta-values" title="永久链接至标题">¶</a></h2>
<p>Excel users can use number formats resembling <code class="docutils literal notranslate"><span class="pre">[h]:mm:ss</span></code> or
<code class="docutils literal notranslate"><span class="pre">[mm]:ss</span></code> to display time interval durations, which <cite>openpyxl</cite>
considers to be equivalent to timedeltas in Python.
<cite>openpyxl</cite> recognizes these number formats when reading XLSX files and
returns datetime.timedelta values for the corresponding cells.</p>
<p>When writing timedelta values from worksheet cells to file, <cite>openpyxl</cite>
uses the <code class="docutils literal notranslate"><span class="pre">[h]:mm:ss</span></code> number format for these cells.</p>
<p class="rubric">Footnotes</p>
<dl class="footnote brackets">
<dt class="label" id="f1"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>For example, the serial 1 in an Excel worksheet can be
interpreted as 00:00, as 24:00, as 1900-01-01, as 1440
(minutes), etc., depending solely on the formatting applied.</p>
</dd>
</dl>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo.png" alt="Logo"/>
            </a></p>
  <div>
    <h3><a href="index.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#">Dates and Times</a><ul>
<li><a class="reference internal" href="#timezones">Timezones</a></li>
<li><a class="reference internal" href="#using-the-iso-8601-format">Using the ISO 8601 format</a></li>
<li><a class="reference internal" href="#the-1900-and-1904-date-systems">The 1900 and 1904 date systems</a></li>
<li><a class="reference internal" href="#handling-timedelta-values">Handling timedelta values</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="formula.html"
                          title="上一章">Parsing Formulas</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="protection.html"
                          title="下一章">保护</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/datetime.rst.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python 模块索引"
             >模块</a> |</li>
        <li class="right" >
          <a href="protection.html" title="保护"
             >下一页</a> |</li>
        <li class="right" >
          <a href="formula.html" title="Parsing Formulas"
             >上一页</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">openpyxl 3.0.9 文档</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Dates and Times</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; 版权所有 2010 - 2022, See AUTHORS.
      由 <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.5.0创建。
    </div>
  </body>
</html>